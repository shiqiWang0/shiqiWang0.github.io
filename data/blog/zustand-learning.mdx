---
title: 'Zustand çŠ¶æ€ç®¡ç†åˆ©å™¨'
date: '2026-01-05'
tags: ['æŠ€æœ¯å­¦ä¹ ä¸åˆ†äº«']
draft: false
summary: çŠ¶æ€ç®¡ç†åˆ©å™¨ä½¿ç”¨å¿ƒå¾—
---

## ğŸ“‘ ç›®å½•

1. [æ˜¯ä»€ä¹ˆï¼Ÿ](#æ˜¯ä»€ä¹ˆ)
2. [ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ](#ä¸ºä»€ä¹ˆéœ€è¦)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [Zustand + Immer å®è·µ](#zustand--immer-å®è·µ)
5. [è¿›é˜¶ä½¿ç”¨](#è¿›é˜¶ä½¿ç”¨)
6. [å¯¹æ¯”åˆ†æ](#å¯¹æ¯”åˆ†æ)
7. [å­¦ä¹ èµ„æº](#å­¦ä¹ èµ„æº)
8. [æ€»ç»“](#æ€»ç»“)

---

## æ˜¯ä»€ä¹ˆï¼Ÿ

**Zustand** æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ React çŠ¶æ€ç®¡ç†åº“ï¼Œå…¶æ ¸å¿ƒç†å¿µæ˜¯ï¼š

> ç”¨æœ€å°‘çš„æ¦‚å¿µï¼Œè§£å†³å…¨å±€çŠ¶æ€å…±äº«é—®é¢˜

### æ ¸å¿ƒç‰¹ç‚¹

* âœ… æç®€ APIï¼šä¸€ä¸ª store å°±æ˜¯ä¸€ä¸ªæ™®é€š Hook
* âœ… é›¶ Providerï¼šæ— éœ€åŒ…è£¹ç»„ä»¶æ ‘
* âœ… æŒ‰éœ€è®¢é˜…ï¼šåªåœ¨é€‰ä¸­çŠ¶æ€å˜åŒ–æ—¶è§¦å‘æ¸²æŸ“
* âœ… TypeScript ä¼˜å…ˆï¼šå¤©ç„¶ç±»å‹æ¨å¯¼

### åŸºæœ¬ç¤ºä¾‹

```ts
import { create } from "zustand";

const useCounterStore = create((set) => ({
  count: 0,
  increment: () => set((state) => ({ count: state.count + 1 })),
}));

// ç»„ä»¶ä¸­ä½¿ç”¨
const count = useCounterStore((state) => state.count);
```

---

## ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ

åœ¨å®é™…é¡¹ç›®ä¸­å¸¸è§ç—›ç‚¹ï¼š

| é—®é¢˜         | ä¼ ç»Ÿæ–¹æ¡ˆ                 | Zustand æ–¹æ¡ˆ |
| ---------- | -------------------- | ---------- |
| Props å±‚å±‚ä¼ é€’ | Context / Redux      | ç›´æ¥è°ƒç”¨ Store |
| çŠ¶æ€åˆ†æ•£       | useReducer + Context | é›†ä¸­ Store   |
| Redux é…ç½®å¤æ‚ | å¤§é‡æ ·æ¿ä»£ç                | é›¶é…ç½®        |
| æ— æ•ˆæ¸²æŸ“       | æ‰‹åŠ¨ memo              | è‡ªåŠ¨æŒ‰éœ€è®¢é˜…     |

**ç‰¹åˆ«é€‚åˆï¼š**

* ä¸­åå°ç³»ç»Ÿ
* è¡¨å•å¯†é›†å‹åº”ç”¨
* å¤šæ¨¡å—å…±äº«çŠ¶æ€

---

## å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ åˆ›å»ºé¡¹ç›®

```bash
pnpm create vite zustand-demo --template react-ts
cd zustand-demo
pnpm install
```

### 2ï¸âƒ£ å®‰è£…ä¾èµ–

```bash
pnpm add zustand
```

### 3ï¸âƒ£ åˆ›å»º Store

`src/stores/counterStore.ts`

```ts
import { create } from "zustand";

interface CounterState {
  count: number;
  name: string;
  increment: () => void;
  decrement: () => void;
  reset: () => void;
  updateName: (name: string) => void;
}

const useCounterStore = create<CounterState>((set) => ({
  count: 0,
  name: "Zustand ç”¨æˆ·",

  increment: () => set((state) => ({ count: state.count + 1 })),
  decrement: () => set((state) => ({ count: state.count - 1 })),
  reset: () => set({ count: 0 }),
  updateName: (name) => set({ name }),
}));

export default useCounterStore;
```

### 4ï¸âƒ£ ç»„ä»¶ä¸­ä½¿ç”¨

```tsx
import useCounterStore from "./stores/counterStore";

function App() {
  const count = useCounterStore((s) => s.count);
  const name = useCounterStore((s) => s.name);
  const { increment, decrement, reset, updateName } = useCounterStore();

  return (
    <div>
      <h1>ğŸ» Zustand Demo</h1>

      <p>{count}</p>
      <button onClick={increment}>+</button>
      <button onClick={decrement}>-</button>
      <button onClick={reset}>reset</button>

      <input onChange={(e) => updateName(e.target.value)} />
      <p>{name}</p>
    </div>
  );
}

export default App;
```

---

## Zustand + Immer å®è·µ

### âŒ ç¹çå†™æ³•

```ts
set((state) => ({
  user: {
    ...state.user,
    profile: {
      ...state.user.profile,
      address: {
        ...state.user.profile.address,
        city: "åŒ—äº¬",
      },
    },
  },
}));
```

### âœ… ä½¿ç”¨ Immer

```bash
pnpm add immer
```

```ts
import { create } from "zustand";
import { produce } from "immer";

const useUserStore = create((set) => ({
  user: {
    name: "å¼ ä¸‰",
    profile: {
      age: 25,
      address: { city: "ä¸Šæµ·", street: "å—äº¬è·¯" },
    },
  },

  updateCity: (city: string) =>
    set(
      produce((state: any) => {
        state.user.profile.address.city = city;
      })
    ),
}));
```

### ä¼˜åŠ¿

| ç»´åº¦   | åŸç”Ÿå†™æ³• | Immer |
| ---- | ---- | ----- |
| ä»£ç é‡  | å¤š    | å°‘     |
| å¯è¯»æ€§  | å·®    | å¥½     |
| åµŒå¥—æ›´æ–° | å¤æ‚   | ç®€å•    |

---

## è¿›é˜¶ä½¿ç”¨

### 1ï¸âƒ£ ç²¾å‡†æ¸²æŸ“ä¼˜åŒ–

```ts
const name = useUserStore((s) => s.name);
```

åˆå¹¶è®¢é˜…ï¼š

```ts
import { shallow } from "zustand/shallow";

const { name, email } = useUserStore(
  (s) => ({ name: s.name, email: s.email }),
  shallow
);
```

---

### 2ï¸âƒ£ ä¸­é—´ä»¶ç»„åˆ

```ts
import { create } from "zustand";
import { devtools, persist } from "zustand/middleware";

const useStore = create(
  devtools(
    persist(
      (set) => ({
        theme: "light",
        toggle: () =>
          set((s) => ({ theme: s.theme === "light" ? "dark" : "light" })),
      }),
      { name: "app-storage" }
    )
  )
);
```

---

### 3ï¸âƒ£ React å¤–éƒ¨è®¿é—®

```ts
const user = useUserStore.getState();
useUserStore.setState({ name: "æ–°ç”¨æˆ·" });
```

---

### 4ï¸âƒ£ å¼‚æ­¥æ“ä½œ

```ts
const useAsyncStore = create((set) => ({
  data: null,
  loading: false,

  fetchData: async () => {
    set({ loading: true });
    const res = await fetch("/api/data");
    const data = await res.json();
    set({ data, loading: false });
  },
}));
```

---

## å¯¹æ¯”åˆ†æ

| ç»´åº¦   | Redux Toolkit    | Context | Zustand  |
| ---- | ---------------- | ------- | -------- |
| ä»£ç é‡  | å¤š                | ä¸­       | å°‘        |
| å­¦ä¹ æˆæœ¬ | é«˜                | ä¸­       | ä½        |
| æ€§èƒ½   | éœ€ä¼˜åŒ–              | æ˜“é‡æ¸²æŸ“    | è‡ªåŠ¨ä¼˜åŒ–     |
| å¼‚æ­¥   | createAsyncThunk | æ‰‹åŠ¨      | ç›´æ¥ async |
| æŒä¹…åŒ–  | æ’ä»¶               | æ‰‹åŠ¨      | å†…ç½®       |

### åœºæ™¯æ¨è

* å°å‹åº”ç”¨ ğŸ‘‰ Zustand
* ä¸­å¤§å‹ ğŸ‘‰ Zustand / Redux
* è¡¨å•å¤æ‚ ğŸ‘‰ Zustand + Immer

---

## å­¦ä¹ èµ„æº

### å®˜æ–¹

* å®˜æ–¹æ–‡æ¡£
* GitHub ä»“åº“
* Middleware æ–‡æ¡£

### ç”Ÿæ€

* React æ–‡æ¡£
* Immer
* Redux DevTools

---

## æ€»ç»“

Zustand çš„ä¸‰ä¸ªæ ¸å¿ƒï¼š

1ï¸âƒ£ **Create** â†’ åˆ›å»º Store
2ï¸âƒ£ **Use** â†’ Hook ä½¿ç”¨çŠ¶æ€
3ï¸âƒ£ **Set** â†’ æ›´æ–°çŠ¶æ€

> ç”¨æœ€ç®€å•çš„æ–¹å¼è§£å†³å¤æ‚çŠ¶æ€ç®¡ç†é—®é¢˜